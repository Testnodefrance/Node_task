<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<head>
<title></title>
</head>
<link rel="stylesheet" type="text/css" href="front.css"> 
<body>

<h2>Пополнение - снятие</h2>
<div id="app">
    <h3>{{ type }}</h3>
    <ul>
        <li v-for="item in types">
            {{ item }}
        </li>
    </ul>
    <ul>
        <li v-for="item in messages">
            {{ item }}
        </li>
    </ul>
    <input type="text"  v-model="contract_num_form">
    <br>
    <input type="text" v-model="oper_balance">
    <br>
    <p>
          <select size="1" v-model="oper_type">
            <option disabled></option>
            <option value="Снятие">Снятие</option>
            <option value="Депозит">Депозит</option>
           </select></p>
    <button @click="make_operation()" >Send</button>
   <!-- ловлю данные с експреса и рисую стартовую таблицу-->
    <h3>Contract table</h3>
    <ul>
            <li v-for="item in contracts">
                Number of contract:
                {{ item.contract_num }}
                <br>
                Balance:
                {{ item.balance }}
            </li>
        </ul>
</div>
<script src="https://cdn.jsdelivr.net/npm/vue@2.5.16/dist/vue.js"></script>
<script src="https://unpkg.com/axios/dist/axios.min.js"></script>
<script>
new Vue({
    el: '#app',
    data: {
        message: "",
        type: "dfsald",
        types: ["cd", "cu", "cc"],
        messages: [],
        contracts: [],
        contract_num_form: "",
        oper_type: "",
        oper_balance: "",
        error: "",
        x: []
    },
    watch: {
        message: function(){
            console.log(this.message);
        }
    },
    methods: {
        sendMessage: function(val){
            console.log(val);
            this.messages.push(val.toString())
        },
        make_debet: function()
        {
            if (Number(x.balance) - Number(this.oper_balance) < 0)
                this.error = prompt("Error!", "Wrong ammount of money!");
            console.log(Number(x.balance) - Number(this.oper_balance));
        },
        make_operation: function(){
            if(this.oper_type !== "Снятие" && this.oper_type !== "Депозит")
                this.error = prompt("Error!", "Wrong type of operation!");
            else if (x = this.contracts.find(x => x.contract_num === this.contract_num_form))
            {
                if(x.contract_num.indexOf("26251") === 0)
                    if (Number(x.balance) - Number(this.oper_balance) < 0 && this.oper_type == "Снятие")
                        this.error = prompt("Error!", "Wrong ammount of money!");
                else if(x.contract_num.indexOf("26252") === 0)
                    if (Number(x.balance) - Number(this.oper_balance) < 50000 && this.oper_type == "Снятие")
                        this.error = prompt("Error!", "Credit limit is over!");
                else if(x.contract_num.indexOf("26253") === 0)
                    if (Number(x.balance) - Number(this.oper_balance) < 150000 && this.oper_type == "Снятие")
                        this.error = prompt("Error!", "Credit limit is over!");
                else
                    this.error = prompt("Error!", "Wrong type of card!");
            }
            else if(this.contract_num_form.length === 17 && this.oper_type === "Депозит")
            {
                error = prompt("Yeah!", "New contract is added!");
              /*  var formData = new FormData();
                formData.append('con_num',this.contract_num_form);
                formData.append('bal',this.oper_balance);*/
               /* const new_contr = {};
                new_contr['num'] = this.contract_num_form;
                new_contr['bal'] = this.oper_balance;

                axios.post('http://localhost:8080/api/new_contract/', new_contr)
                .then(res => {
                    return res;
                });*/
                axios.post('http://localhost:8080/api/new_contract/', {
                contracts:
                {
                    contract_num:this.contract_num_form,
                    balance: this.oper_balance
                }
                })
                .then(function (response) {
                console.log(response);
                })
                .catch(function (error) {
                console.log("FUUUCK!");
                });
            }
            else
                this.error = prompt("Error!", "No such card in base!");
        }
    },
    created: function(){
        this.type="12334";
        let self = this;
        axios.get('http://localhost:8080/api/contracts/')
        .then(function (response) {
            console.log(response)
            self.contracts = response.data.contracts;
        })
        .catch(function (error) {
            console.log(error);
        });
    },

  })
</script>
</body>
</html>